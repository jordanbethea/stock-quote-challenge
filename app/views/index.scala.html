@()

@main("Check some Stocks!") {
  <h1>Check some stock prices!</h1>
  <h3>Add a stock to watch:</h3>
  <input type="text" id="addStock">
  <button id="addStockButton" onclick="addStock()">Add Stock to watchlist</button>
  <p id="watchListMessage"></p>
  <h3>Watched Stocks:</h3>
  <ul id="watchedStocksList">

  </ul>
  <button onclick="loadStocks()">Reload Stocks</button>


  <script type="text/javascript">
    function addStock(){
      let code = $("#addStock").val();
      let request = $.ajax({
        method: "PUT",
        url: "/api/watchList",
        processData: false,
        contentType: 'application/json',
        data: JSON.stringify({ code : code })
      });
      request.done(function(msg) {
        $("#watchListMessage").html(msg);
        loadStocks();
      })
      request.fail(function(jqXHR, msg){
        $("#watchListMessage").html(jqXHR.responseText);
      })
    }

    function loadStocks(){
      let stocks = [];
      $.getJSON("api/watchList", function(data){
        $("#watchedStocksList").html(data);
      })
    }

    $.ready(loadStocks)
  </script>
}
